-- Prozedur: GET_BEW_EIG_PRO_HAUS
-- Generiert: 2025-05-31 10:26:41

CREATE OR ALTER PROCEDURE GET_BEW_EIG_PRO_HAUS
DECLARE VARIABLE IHAUSTYP INTEGER;
BEGIN
  /* Procedure body */
  SELECT BSONST FROM objekte
   WHERE ONR=:IONR INTO :IHAUSTYP;
  /* BEWOHNER */
  IF (IBEW=0 AND IHAUSTYP<>1) THEN
   BEGIN
   FOR SELECT KNR, ba.BNAME || ' ' || ba.BVNAME AS NAME, ba.BKONTO, ba.BBLZ, ba.BBANK, ba.BKONTOINH 
    FROM bewohner b, bewadr ba 
    WHERE (b.bewnr=ba.bewnr) and (ONR=:IONR) 
    ORDER BY KNR
    INTO KNR, NAME, KONTO, BLZ, BANK, KONTOINHABER
    DO
     BEGIN
      EXECUTE PROCEDURE GET_KNRSTR(KNR) RETURNING_VALUES KNRSTR;
      IF (KONTOINHABER='') tHEN
       KONTOINHABER=NAME;
      SUSPEND;
     END
   END
  ELSE
  /* EIGENTUEMER */
  IF (IBEW=1 AND IHAUSTYP<>0) THEN
   BEGIN
    FOR SELECT KNR, EIGADR.ENAME || ' ' || EIGADR.EVNAME AS NAME,
     EIGADR.EKONTO, EIGADR.EBLZ, EIGADR.EBANK, EIGADR.EKONTOINH
    FROM eigentuemer, eigadr
    WHERE ONR=:IONR
    AND EIGENTUEMER.EIGNR = EIGADR.EIGNR
    ORDER BY KNR
    INTO KNR, NAME, KONTO, BLZ, BANK, KONTOINHABER
    DO
     BEGIN
      EXECUTE PROCEDURE GET_KNRSTR(KNR) RETURNING_VALUES KNRSTR;
      IF (KONTOINHABER='') tHEN
       KONTOINHABER=NAME;
      SUSPEND;
     END
   END
END
