-- Prozedur: GET_KNRSTR
-- Generiert: 2025-05-31 10:26:41

CREATE OR ALTER PROCEDURE GET_KNRSTR
DECLARE VARIABLE ENR INTEGER;
 DECLARE VARIABLE IANZWECHSEL INTEGER;
BEGIN
  /* Macht aus KNR 100100 KNRSTR 'B.001.00', Sachkonten 4000 in '04000' */
  IF (KNR<100000) THEN
   BEGIN
    IF (KNR<10) THEN
     KNRSTR = '0000' || CAST(KNR AS VARCHAR(1));
    ELSE
     IF (KNR<100) THEN
      KNRSTR = '000' || CAST(KNR AS VARCHAR(2));
     ELSE
      IF (KNR<1000) THEN
       KNRSTR = '00' || CAST(KNR AS VARCHAR(3));
      ELSE
       IF (KNR<10000) THEN
        KNRSTR = '0' || CAST(KNR AS VARCHAR(4));
       ELSE
        KNRSTR = CAST(KNR AS VARCHAR(5));
   END
  ELSE
   BEGIN
    IF (KNR<200000) THEN
     BEGIN
      ENR=(KNR-100000) / 100;
      IANZWECHSEL = KNR - 100000 - (ENR * 100);
      KNRSTR = 'B.';
     END
    ELSE
     BEGIN
      ENR=(KNR-200000) / 100;
      IANZWECHSEL = KNR - 200000 - (ENR * 100);
      KNRSTR = 'E.';
     END
    IF (ENR<10) THEN
     KNRSTR = KNRSTR || '00';
    ELSE
     IF (ENR<100) THEN
      KNRSTR = KNRSTR || '0';
    KNRSTR = KNRSTR || CAST(ENR AS VARCHAR(3));
    KNRSTR = KNRSTR || '.';
    IF (IANZWECHSEL < 10) THEN
     KNRSTR = KNRSTR || '0';
    KNRSTR = KNRSTR || CAST(IANZWECHSEL AS VARCHAR(2));
   END
  SUSPEND;
END
