-- Prozedur: GET_GEBURTSTAGSLIST
-- Generiert: 2025-05-31 10:26:41

CREATE OR ALTER PROCEDURE GET_GEBURTSTAGSLIST
DECLARE VARIABLE vONR INTEGER;
DECLARE VARIABLE vKNR INTEGER;
DECLARE VARIABLE vGEB DATE;
DECLARE VARIABLE vKON CHAR(40);
DECLARE VARIABLE vTyp INTEGER;
DECLARE VARIABLE vEIG INTEGER;
BEGIN
  /* Procedure body */

  FOR SELECT ONR, KNR, GEBURTSTAG, KONFESSION FROM betreut ORDER BY ONR
  INTO vONR, vKNR, vGEB, :cKONFESSION
  DO
   BEGIN
    SELECT BSONST FROM objekte WHERE ONR = :vONR
    INTO vTyp;

    IF (vTyp = 1) THEN
     BEGIN
      SELECT EIGNR FROM eigentuemer WHERE ONR = :vONR AND KNR = :vKNR
      INTO vEIG;
      SELECT ENAME,EVNAME FROM eigadr WHERE EIGNR = :vEIG
      INTO :cNAME, :cVNAME;
      ENR = (vKNR - 200000)/100;
     END
    ELSE
     BEGIN
      --SELECT BNAME,BVNAME FROM bewohner WHERE ONR = :vONR AND KNR = :vKNR
      SELECT ba.BNAME, ba.BVNAME 
      FROM bewohner b, bewadr ba WHERE b.bewnr=ba.bewnr and ONR = :vONR AND KNR = :vKNR
      INTO :cNAME, :cVNAME;
      ENR = (vKNR - 100000)/100;
     END
   ONR = vONR;
   DGEBURTSTAG = vGEB;
   SUSPEND;
   END
 END
