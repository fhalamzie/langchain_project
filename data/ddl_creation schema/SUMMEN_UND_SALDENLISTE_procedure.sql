-- Prozedur: SUMMEN_UND_SALDENLISTE
-- Generiert: 2025-05-31 10:26:42

CREATE OR ALTER PROCEDURE SUMMEN_UND_SALDENLISTE
DECLARE VARIABLE KKLASSE_VON INTEGER;
DECLARE VARIABLE KKLASSE_BIS INTEGER;
DECLARE VARIABLE SOLL_PLUS CHAR(1);
BEGIN
 IF (IBESTANDSKONTEN=1) THEN
  BEGIN
   KKLASSE = 1; /* Aktive Bestandskonten 20 bis 24*/
   KKLASSE_VON = 20;
   KKLASSE_BIS = 24;
   SOLL_PLUS = 'J';
   SUM_SALDO=0;
   FOR
    SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_klasse(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,1,:IEBWERTSACHKONTEN)
    into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
   begin
    IF (SALDO_SH='S') then
     SUM_SALDO=SUM_SALDO+SALDO;
    ELSE
     SUM_SALDO=SUM_SALDO-SALDO;
    IF (KNR<90000) THEN
     SUSPEND;
   end
   
   IF (ISBRUTTO=0) THEN
    BEGIN
     /* VORSTEUER */
     KKLASSE_VON = 1;
     KKLASSE_BIS = 1;
     SOLL_PLUS = 'J';
     FOR
      SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_ust(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,:ISBRUTTO,:IEBWERTSACHKONTEN)
      into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
     begin
      IF (SALDO_SH='S') then
       SUM_SALDO=SUM_SALDO+SALDO;
      ELSE
       SUM_SALDO=SUM_SALDO-SALDO;
      SUSPEND;
     end
     /* UMSATZSTEUER */
     KKLASSE_VON = 10;
     KKLASSE_BIS = 19;
     SOLL_PLUS = 'J';
     FOR 
      SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_ust(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,:ISBRUTTO,:IEBWERTSACHKONTEN)
      into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
     begin
      IF (SALDO_SH='S') then
       SUM_SALDO=SUM_SALDO+SALDO;
      ELSE
       SUM_SALDO=SUM_SALDO-SALDO;
      SUSPEND;
     END
    END  /* ISBRUTTO */
   KKLASSE = 3; /* passive Bestandskonten 27*/
   KKLASSE_VON = 27;
   KKLASSE_BIS = 27;
   SOLL_PLUS = 'N';
   SUM_SALDO=0;
   FOR
    SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_klasse(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,1,:IEBWERTSACHKONTEN)
    into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
   begin
    IF (SALDO_SH='S') then
     SUM_SALDO=SUM_SALDO+SALDO;
    ELSE
     SUM_SALDO=SUM_SALDO-SALDO;
    SUSPEND;
   end
  end  /* IBESTANDSKONTEN */

 IF (ISACHKONTEN=1) THEN
  BEGIN
   KKLASSE = 4; /* Einnahmen */
   KKLASSE_VON = 10;
   KKLASSE_BIS = 19;
   SOLL_PLUS = 'J';
   SUM_SALDO=0;
   FOR
    SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_klasse(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,:ISBRUTTO,:IEBWERTSACHKONTEN)
    into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
   begin
    IF (SALDO_SH='S') then
     SUM_SALDO=SUM_SALDO+SALDO;
    ELSE
     SUM_SALDO=SUM_SALDO-SALDO;
    SUSPEND;
   end
   /* RÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢ÃƒÆ’Ã¢â‚¬Â ÃƒÂ¢Ã¢â€šÂ¬Ã¢â€žÂ¢ÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â¼cklagen */
   KKLASSE_VON = 110;
   KKLASSE_BIS = 580;
   SOLL_PLUS = 'J';
   FOR
    SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_klasse(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,:ISBRUTTO,:IEBWERTSACHKONTEN)
    into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
   begin
    IF (SALDO_SH='S') then
     SUM_SALDO=SUM_SALDO+SALDO;
    ELSE
     SUM_SALDO=SUM_SALDO-SALDO;
    SUSPEND;
   end
   KKLASSE = 5; /* Ausgaben */
   KKLASSE_VON = 1;
   KKLASSE_BIS = 1;
   SOLL_PLUS = 'J';
   SUM_SALDO=0;
   FOR
    SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_klasse(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,:ISBRUTTO,:IEBWERTSACHKONTEN)
    into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
   begin
    IF (SALDO_SH='S') then
     SUM_SALDO=SUM_SALDO+SALDO;
    ELSE
     SUM_SALDO=SUM_SALDO-SALDO;
    SUSPEND;
   end
   /* ErÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢ÃƒÆ’Ã¢â‚¬Â ÃƒÂ¢Ã¢â€šÂ¬Ã¢â€žÂ¢ÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â·ffnungsbilantkonten, Durchlauf, auch eigene Durchlaufkonen 9xxxxx */
   KKLASSE = 9; /* EB */
   KKLASSE_VON = 30;
   KKLASSE_BIS = 30;
   SOLL_PLUS = 'J';
   SUM_SALDO=0;
   FOR 
    SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_klasse(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,:ISBRUTTO,:IEBWERTSACHKONTEN)
    into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
   begin
    IF (SALDO_SH='S') then
     SUM_SALDO=SUM_SALDO+SALDO;
    ELSE
     SUM_SALDO=SUM_SALDO-SALDO;
    SUSPEND;
   end
   /* selbst angelegte Bestandskonten A mit 9xxxxx */
   KKLASSE_VON = 20;
   KKLASSE_BIS = 24;
   SOLL_PLUS = 'J';
   FOR 
    SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_klasse(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,1,:IEBWERTSACHKONTEN)
    into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
   begin
    IF (KNR>=90000) THEN /* 9xxxx sind Durchlaufkonten */
     BEGIN
      IF (SALDO_SH='S') then
       SUM_SALDO=SUM_SALDO+SALDO;
      ELSE
       SUM_SALDO=SUM_SALDO-SALDO;
      SUSPEND;
     END 
   end
  end  /* Durchlauf */

 IF (IDEBITOREN=1) THEN
  BEGIN
   KKLASSE = 10; /* DEBITOREN */
   KKLASSE_VON = 60;
   KKLASSE_BIS = 62;
   SOLL_PLUS = 'J';
   SUM_SALDO=0;
   FOR 
    SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_klasse(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,1,:IEBWERTSACHKONTEN)
    into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
   begin
    IF (SALDO_SH='S') then
     SUM_SALDO=SUM_SALDO+SALDO;
    ELSE
     SUM_SALDO=SUM_SALDO-SALDO;
    SUSPEND;
   end
  end  /* DEBITOREN */

 IF (IKREDITOREN=1) THEN
  BEGIN
   KKLASSE = 70; /* Kreditoren */
   KKLASSE_VON = 71;
   KKLASSE_BIS = 71;
   SOLL_PLUS = 'N';
   SUM_SALDO=0;
   FOR 
    SELECT KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH from summen_und_saldenliste_klasse(:IONR,:DTVON,:DTBIS,:DTEBWERT,:KKLASSE_VON,:KKLASSE_BIS,:SOLL_PLUS,:KKLASSE,1,:IEBWERTSACHKONTEN)
    into KNR,KBEZ,EBWERT_S,EBWERT_H,EBWERT,SALDO_S,SALDO_H,SALDO_KUM_S,SALDO_KUM_H,SALDO,EBWERT_SH,SALDO_SH do
   begin
    IF (SALDO_SH='S') then
     SUM_SALDO=SUM_SALDO+SALDO;
    ELSE
     SUM_SALDO=SUM_SALDO-SALDO;
    SUSPEND;
   end
  end  /* KREDITOREN */
end
