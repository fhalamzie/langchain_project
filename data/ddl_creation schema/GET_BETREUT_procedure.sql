-- Prozedur: GET_BETREUT
-- Generiert: 2025-05-31 10:26:41

CREATE OR ALTER PROCEDURE GET_BETREUT
DECLARE VARIABLE vONR INTEGER;
DECLARE VARIABLE vKNR INTEGER;
DECLARE VARIABLE vGES INTEGER;
DECLARE VARIABLE vTOD INTEGER;
DECLARE VARIABLE vHAU INTEGER;
DECLARE VARIABLE vFA1 INTEGER;
DECLARE VARIABLE vFA2 INTEGER;
DECLARE VARIABLE vA1 INTEGER;
DECLARE VARIABLE vA2 INTEGER;
DECLARE VARIABLE vA3 INTEGER;
DECLARE VARIABLE vTyp INTEGER;
DECLARE VARIABLE vEIG INTEGER;
BEGIN
  /* Procedure body */
  SELECT ONR,KNR,PFLEGESTUFE,PFLEGEORGA,VERSICHERUNG1,VNUMMER1,VTEL1,VFAX1,VSTRASSE1,
         VORT1,VBEARBEITER1,VERSICHERUNG2,VNUMMER2,VTEL2,VFAX2 ,VSTRASSE2 ,VORT2 ,
         VBEARBEITER2 ,VORKEHRUNGEN ,KRANKHEIT ,DAUERMED ,BEDARFMED ,HILFSMITTEL ,
         PFLEGELEISTUNGEN ,PVER , VV ,BVER ,FACHA1ID,FACHA2ID ,HAUSAID , TODID ,
         GESCHAEFTID ,SONSTLEISTUNGEN ,ANG1ID ,ANG2ID ,ANG3ID ,GEBURTSTAG ,GEBURTSORT ,
         GEBURTSNAME ,KONFESSION, FAMILIENSTAND,INTERESSEN,PROBLEME,ESSEN FROM betreut WHERE ONR =:iONR AND KNR=:iKNR
  INTO vONR, vKNR, :PFLEGESTUFE,:PFLEGEORGA,:VERSICHERUNG1,:VNUMMER1,:VTEL1,:VFAX1,:VSTRASSE1,
         :VORT1,:VBEARBEITER1,:VERSICHERUNG2,:VNUMMER2,:VTEL2,:VFAX2 ,:VSTRASSE2 ,:VORT2 ,
         :VBEARBEITER2 ,:VORKEHRUNGEN ,:KRANKHEIT ,:DAUERMED ,:BEDARFMED ,:HILFSMITTEL ,
         :PFLEGELEISTUNGEN ,:PVER , :VV ,:BVER ,vFA1,vFA2 ,vHAU , vTOD ,
         vGES ,:SONSTLEISTUNGEN ,vA1 ,vA2 ,vA3 ,:GEBURTSTAG ,:GEBURTSORT ,
         :GEBURTSNAME ,:KONFESSION, :FAMILIENSTAND,:INTERESSEN,:PROBLEME,:ESSEN;

  SELECT BSONST FROM objekte WHERE ONR = :vONR
  INTO vTyp;

  IF (vTyp = 1) THEN
   BEGIN
    SELECT EIGNR FROM eigentuemer WHERE ONR = :vONR AND KNR = :vKNR
    INTO vEIG;
    SELECT ENAME,EVNAME FROM eigadr WHERE EIGNR = :vEIG
    INTO :NAME, :VNAME;
    ENR = (vKNR - 200000)/100;
   END
  ELSE
   BEGIN
--    SELECT BNAME,BVNAME FROM bewohner WHERE ONR = :vONR AND KNR = :vKNR
    SELECT ba.BNAME,ba.BVNAME 
    FROM bewohner b, bewadr ba 
    WHERE b.bewnr=ba.bewnr and ONR = :vONR AND KNR = :vKNR
    INTO :NAME, :VNAME;
    ENR = (vKNR - 100000)/100;
   END
  ONR = vONR;

  SELECT NAME, VORNAME, TEL1, TEL2, MOBIL FROM lieferan WHERE KNR =: vTOD
  INTO :TNAME,:TVNAME,:TTEL1,:TTEL2,:TMOBIL;

  SELECT NAME, VORNAME, TEL1, TEL2, MOBIL FROM lieferan WHERE KNR =: vGES
  INTO :GNAME,:GVNAME,:GTEL1,:GTEL2,:GMOBIL;

  SELECT NAME, VORNAME, TEL1, TEL2, MOBIL FROM lieferan WHERE KNR =: vHAU
  INTO :HNAME,:HVNAME,:HTEL1,:HTEL2,:HMOBIL;

  SELECT NAME, VORNAME, TEL1, TEL2, MOBIL FROM lieferan WHERE KNR =: vFA1
  INTO :F1NAME,:F1VNAME,:F1TEL1,:F1TEL2,:F1MOBIL;

  SELECT NAME, VORNAME, TEL1, TEL2, MOBIL FROM lieferan WHERE KNR =: vFA2
  INTO :F2NAME,:F2VNAME,:F2TEL1,:F2TEL2,:F2MOBIL;

  SELECT NAME, VORNAME, TEL1, TEL2, MOBIL FROM lieferan WHERE KNR =: vA1
  INTO :F2NAME,:F2VNAME,:F2TEL1,:F2TEL2,:F2MOBIL;

  SELECT NAME, VORNAME, TEL1, TEL2, MOBIL FROM lieferan WHERE KNR =: vA2
  INTO :F2NAME,:F2VNAME,:F2TEL1,:F2TEL2,:F2MOBIL;

  SELECT NAME, VORNAME, TEL1, TEL2, MOBIL FROM lieferan WHERE KNR =: vA3
  INTO :F2NAME,:F2VNAME,:F2TEL1,:F2TEL2,:F2MOBIL;

  SUSPEND;
END
